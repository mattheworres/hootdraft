# Installing PHP Draft

 1. After downloading the latest release, extract the project to a temporary local directory.

 1. Create an empty MySQL database (as well as a corresponding MySQL user that has full access to the database) named `phpdraft`. 
     - If your hosting prepends your account name to the database name that's OK, just be sure to edit `initialize.sql` to match (Step 3) and `appsettings.php` (Step 5) with the correct name.

 1. Execute `/api/Domain/Migrations/initialize.sql` on the `phpdraft` database.
     - If your database name is not precisely `phpdraft`, you must edit **Line 4** of this script to reflect this *before* executing the script.

 1. Copy `[temp local directory]/api/config/EXAMPLE_appsettings.php` to your temporary local directory (so in the same folder as `index.html`), renaming it to `appsettings.php`.

 1. Open `appsettings.php` in a text editor, and edit all applicable settings:

    - `DB_HOST`, `DB_PORT`, `DB_USER` and `DB_PASS` will need to be updated to allow PHP Draft to connect to the MySQL database
    - `DB_NAME` corresponds to the database name. In most cases, this can be `phpdraft`
    - `AUTH_KEY` is a secret key that will be used to generate login tokens. Keep it safe (do NOT share it!). If you're not sure what this is, use a "CodeIgniter Encryption Key" generated by www.randomkeygen.com
    - `RECAPTCHA_SECRET` is the private key for your Google reCAPTCHA 2 account. Without it new user registration will fail.
    - `MAIL_SERVER`, `MAIL_USER`, `MAIL_PASS` and `MAIL_PORT` allow PHP Draft to send emails for both new user email verification and password reset emails.
    - `APP_BASE_URL` is the home URL for your PHP Draft installation - for example `http://www.example.com/phpdraft` (whatever you type in to the browser to load PHP Draft). *No trailing slashes!*
    - `API_BASE_URL` is the base url for your PHP Draft API - which should be the same as `APP_BASE_URL` except with `/api` appended to it, like: `http://www.example.com/phpdraft/api`
    - The rest you can read up and configure as you like, but the above settings are the bare minimum.

 1. If your PHP Draft install will be at the base of the domain or subdomain (as in `sub.example.com` or `www.example.com`), **you may skip this step**. If your base URL looks like www.example.com/phpdraft, **do the following**:

    - Open `index.html` and find this HTML: `<base href="/">` and change it to match the directory path after the base domain. So if your base URL is `www.example.com/phpdraft`, then you must edit the HTML like this: `<base href="/phpdraft/">`
    - If running on a Unix server, you will additionally need to edit line 5 of `.htaccess` like so: `RewriteBase /phpdraft`

 1. Open `js/config.js` and update two values to match your installation:

    - **apiEndpoint** should be a fully qualified URL that points to your PHP Draft API (so `http://www.example.com/phpdraft/api/` is valid - note the trailing slash)
    - **recaptchaPublicKey** should contain the *public key* portion of your Google reCAPTCHA 2 key

 1. **If you do not have HTTPS enabled**, you must disable the default URL rewrites that PHP Draft ships with.
    - This is not recommended. For your users' security, use HTTPS! *All those who enter abandon hope here*
    - For **Unix-based servers**, comment out **Lines 9 and 10** of `.htaccess`
    - For **Windows (IIS) servers**, comment out the entire `Redirect to https` rule (**lines 8 - 14**)

 1. With your FTP client upload all contents of your temporary local directory into the directory that PHP Draft will exist.

 1. Go to the base URL of your PHP Draft install and register a new user account with your email address.

 1. In the `phpdraft` database, find the row in the `users` table that corresponds to your newly created account. Make three edits:

    - Change the value in the `enabled` column to `1` (which will enable your account)
    - Change the value in the `roles` column to `ROLE_ADMIN,ROLE_COMMISH` (which will make your account both a site administrator and a commissioner)
    - Change the value in the `verificationKey` to `NULL` (this deletes the key contained in the new user email sent to your email address - you don't need to validate your own email :) )

 1. Log in with your email address and password.

 1. In the top header bar, click on **Admin Stuff** then select **Player Data**. Using the CSV files contained in the `/resources/` directory, update each sport with the matching CSV file:

  Sport                      | CSV File
  -------------              | -------------
  Football (NFL)             | ProPlayers_NFLStandard_20xx.csv
  Football - Extended Rosters (NFL)    | ProPlayers_NFLExtended_20xx.csv
  Baseball (MLB)             | ProPlayers_MLB_20xx.csv
  Basketball (NBA)             | ProPlayers_NBA_20xx.csv
  Hockey (NHL)               | ProPlayers_NHL_20xx.csv
  Rugby (Super15)            | ProPlayers_Super15_20xx.csv

##### Congratulations! You have installed PHP Draft. Enjoy!

#### Common Issues

1. If you are encountering issues while `SaltService` attempts to create password salts (in new user registration and forgotten password processes), your installation of PHP may be missing the `mcrypt` extension. Depending on what type of PHP you have installed your mileage may vary, but `SaltService` requires the extension to be installed and enabled.

1. If you encounter issues at the end of the draft (like the draft ends on an error), and you also cannot manually generate the draft statistics for that draft through the Admin option on the site, it's likely due to the fact that MySQL's `ONLY_FULL_GROUP_BY` option is enabled and is breaking the SQL query/queries related to draft stats. See this StackOverflow thread for some help: http://stackoverflow.com/a/36033983/324527 (H/T to user `Eyo Okon Eyo`)